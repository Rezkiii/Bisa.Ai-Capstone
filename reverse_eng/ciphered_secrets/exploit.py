import base64

def custom_substitution_decrypt(text):
    # Create a reverse substitution mapping
    substitution_map = {v: k for k, v in {
        'a': 'm', 'b': 'n', 'c': 'o', 'd': 'p', 'e': 'q',
        'f': 'r', 'g': 's', 'h': 't', 'i': 'u', 'j': 'v',
        'k': 'w', 'l': 'x', 'm': 'y', 'n': 'z', 'o': 'a',
        'p': 'b', 'q': 'c', 'r': 'd', 's': 'e', 't': 'f',
        'u': 'g', 'v': 'h', 'w': 'i', 'x': 'j', 'y': 'k',
        'z': 'l', ' ': '_'
    }.items()}
    return ''.join(substitution_map.get(char, char) for char in text)

def caesar_cipher(text, shift):
    decrypted = ""
    for char in text:
        if char.isalpha():
            shifted = ord(char) + shift
            if char.islower():
                if shifted < ord('a'):
                    shifted += 26
            elif char.isupper():
                if shifted < ord('A'):
                    shifted += 26
            decrypted += chr(shifted)
        else:
            decrypted += char
    return decrypted

def reveal_flag(encoded_flag):
    # Step 1: Base64 decode
    decoded_flag = base64.b64decode(encoded_flag).decode()
    
    # Step 2: Reverse Caesar cipher
    caesar_decrypted_flag = caesar_cipher(decoded_flag, -5)  # Shift back by 5
    
    # Step 3: Reverse custom substitution
    return custom_substitution_decrypt(caesar_decrypted_flag)

if __name__ == "__main__":
    # Replace with the obfuscated flag obtained from the challenge
    encoded_flag = "dHJnamtmZXZ7dnl2X3JlZmt5dmlfaXZtdmlqdl92ZXh6ZXZ2aXpleH0="
    
    print("Revealed Flag:", reveal_flag(encoded_flag))
